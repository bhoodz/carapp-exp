version: 0.2

phases: 
    install:
        runtime-versions:
            nodejs: 10
        commands:
            - npm install -g serverless
            - npm install            
    build:
        commands:
            - npm run test
            - serverless deploy --stage test -v
            # create directory for deployment packages
            - mkdir artifacts
            # create staging deployment package
            - mkdir artifacts/stg
            - serverless package --package artifacts/stg --stage stg -v
            # create prod deployment package
            - mkdir artifacts/prod
            - serverless package --package artifacts/prod --stage prod -v

artifacts:
  files:
    - artifacts/**/*
    - serverless.yml
    - deploy.sh
            
